# Sticky Scrollbar 浏览器插件需求文档

## 1. 项目背景

在 Web 应用中，当页面存在高度较高的 DOM 元素（如数据表格、长列表等）且内容宽度超出视窗时，用户必须滚动到元素底部才能使用横向滚动条，这种交互体验极差。本插件旨在解决这一问题，通过提供浮动的横向滚动条来改善用户体验。

## 2. 项目目标

开发一个通用、轻量级、无框架依赖的浏览器插件，为任意可滚动容器提供浮动的横向滚动条，使用户无需滚动到底部即可进行横向滚动操作。

## 3. 功能需求

### 3.1 核心功能

- **浮动滚动条**：在视窗底部显示与原始滚动条同步的浮动横向滚动条
- **双向同步**：浮动滚动条与原始容器的 scrollLeft 位置实时同步
- **智能检测**：自动检测容器是否需要横向滚动
- **响应式**：支持窗口大小变化和动态内容变化

### 3.2 交互功能

- **拖拽滚动**：支持鼠标拖拽浮动滚动条进行滚动
- **点击跳转**：点击浮动滚动条轨道可快速跳转到对应位置
- **滚轮支持**：鼠标悬停在浮动滚动条上时支持滚轮横向滚动
- **触摸支持**：支持触摸设备的滑动操作

### 3.3 显示控制

- **自动隐藏**：当容器不需要横向滚动时自动隐藏浮动滚动条
- **悬停显示**：鼠标悬停在相关区域时显示浮动滚动条
- **固定显示**：可配置为始终显示浮动滚动条
- **透明度控制**：支持设置浮动滚动条的透明度

### 3.4 兼容性

- **浏览器兼容**：支持 Chrome、Firefox、Safari、Edge 等现代浏览器
- **框架兼容**：纯原生 JavaScript 实现，可与 Vue、React、Angular 等框架无缝集成
- **移动端兼容**：支持 iOS Safari、Android Chrome 等移动浏览器

## 4. 配置参数

### 4.1 基础配置

| 参数名     | 类型           | 默认值   | 描述                                      |
| ---------- | -------------- | -------- | ----------------------------------------- |
| `target`   | string/Element | -        | 目标容器选择器或 DOM 元素（必需）         |
| `position` | string         | 'bottom' | 浮动滚动条位置：'bottom'、'top'、'custom' |
| `offset`   | number         | 0        | 浮动滚动条距离视窗边缘的偏移量（像素）    |
| `zIndex`   | number         | 9999     | 浮动滚动条的 z-index 值                   |

### 4.2 显示配置

| 参数名         | 类型   | 默认值 | 描述                                |
| -------------- | ------ | ------ | ----------------------------------- |
| `showMode`     | string | 'auto' | 显示模式：'always'、'hover'、'auto' |
| `opacity`      | number | 0.7    | 浮动滚动条透明度（0-1）             |
| `hoverOpacity` | number | 1.0    | 鼠标悬停时的透明度                  |
| `hideDelay`    | number | 300    | 自动隐藏延迟时间（毫秒）            |

### 4.3 样式配置

| 参数名            | 类型   | 默认值               | 描述                   |
| ----------------- | ------ | -------------------- | ---------------------- |
| `height`          | number | 8                    | 浮动滚动条高度（像素） |
| `borderRadius`    | number | 4                    | 滚动条圆角大小（像素） |
| `backgroundColor` | string | 'rgba(0, 0, 0, 0.2)' | 轨道背景色             |
| `thumbColor`      | string | 'rgba(0, 0, 0, 0.5)' | 滑块颜色               |
| `thumbHoverColor` | string | 'rgba(0, 0, 0, 0.7)' | 滑块悬停颜色           |

### 4.4 行为配置

| 参数名           | 类型    | 默认值 | 描述                         |
| ---------------- | ------- | ------ | ---------------------------- |
| `syncSpeed`      | number  | 16     | 同步动画帧率（毫秒）         |
| `enableKeyboard` | boolean | true   | 是否启用键盘方向键控制       |
| `enableWheel`    | boolean | true   | 是否启用鼠标滚轮横向滚动     |
| `enableTouch`    | boolean | true   | 是否启用触摸滑动             |
| `debounceDelay`  | number  | 100    | 窗口 resize 防抖延迟（毫秒） |

### 4.5 高级配置

| 参数名             | 类型    | 默认值 | 描述                      |
| ------------------ | ------- | ------ | ------------------------- |
| `watchChanges`     | boolean | true   | 是否监听 DOM 变化自动更新 |
| `excludeSelectors` | array   | []     | 排除的子元素选择器数组    |
| `includePadding`   | boolean | true   | 计算时是否包含 padding    |
| `includeBorder`    | boolean | false  | 计算时是否包含 border     |
| `customClass`      | string  | ''     | 自定义 CSS 类名           |

## 5. API 接口

### 5.1 实例方法

```javascript
// 初始化
const scrollbar = new StickyScrollbar("#myTable", options);

// 方法
scrollbar.update(); // 手动更新滚动条
scrollbar.destroy(); // 销毁实例
scrollbar.show(); // 显示滚动条
scrollbar.hide(); // 隐藏滚动条
scrollbar.refresh(); // 重新计算尺寸
scrollbar.getPosition(); // 获取当前滚动位置
scrollbar.setPosition(x); // 设置滚动位置
```

### 5.2 事件监听

```javascript
scrollbar.on("scroll", (position) => {
  console.log("滚动位置:", position);
});

scrollbar.on("show", () => {
  console.log("滚动条显示");
});

scrollbar.on("hide", () => {
  console.log("滚动条隐藏");
});
```

## 6. 使用场景

### 6.1 典型应用场景

- **数据表格**：大数据量的表格展示
- **图片画廊**：横向滚动的图片展示
- **代码编辑器**：宽屏代码编辑区域
- **仪表盘**：复杂的报表和数据展示
- **产品列表**：横向排列的商品展示

### 6.2 使用示例

```javascript
// 基础使用
new StickyScrollbar(".data-table");

// 完整配置
new StickyScrollbar("#myTable", {
  position: "bottom",
  offset: 10,
  showMode: "hover",
  height: 6,
  backgroundColor: "rgba(24, 144, 255, 0.2)",
  thumbColor: "rgba(24, 144, 255, 0.8)",
  enableKeyboard: true,
  watchChanges: true,
});
```

## 7. 性能要求

### 7.1 性能指标

- **初始化时间**：< 50ms（中等规模页面）
- **滚动同步延迟**：< 16ms（60fps）
- **内存占用**：< 1MB（单个实例）
- **CPU 使用率**：滚动时<5%（现代浏览器）

### 7.2 优化策略

- 使用`requestAnimationFrame`进行滚动同步
- 事件监听防抖和节流
- 惰性计算和缓存策略
- DOM 查询优化

## 8. 测试需求

### 8.1 功能测试

- [ ] 不同浏览器兼容性测试
- [ ] 响应式布局测试
- [ ] 动态内容变化测试
- [ ] 嵌套滚动容器测试
- [ ] 极端尺寸测试

### 8.2 性能测试

- [ ] 大数据量表格测试（1000+行，50+列）
- [ ] 高频滚动测试
- [ ] 内存泄漏检测
- [ ] 移动端性能测试

## 9. 部署方案

### 9.1 安装方式

```bash
# npm安装
npm install sticky-scrollbar

# CDN引入
<script src="https://cdn.jsdelivr.net/npm/sticky-scrollbar@latest/dist/sticky-scrollbar.min.js"></script>

# 浏览器插件
Chrome Web Store / Firefox Add-ons
```

### 9.2 构建产物

- `sticky-scrollbar.js` - 开发版（未压缩，包含 sourcemap）
- `sticky-scrollbar.min.js` - 生产版（压缩版）
- `sticky-scrollbar.esm.js` - ES 模块版
- 浏览器插件包（Chrome/Firefox/Safari）

## 10. 版本规划

### 10.1 MVP 版本（v1.0.0）

- [ ] 基础浮动滚动条功能
- [ ] 核心配置参数
- [ ] 基础浏览器兼容
- [ ] 简单 API 接口

### 10.2 增强版本（v1.1.0）

- [ ] 移动端触摸支持
- [ ] 键盘快捷键支持
- [ ] 主题系统
- [ ] 更多配置选项

### 10.3 高级版本（v1.2.0）

- [ ] 浏览器插件版本
- [ ] 虚拟滚动支持
- [ ] 性能监控
- [ ] 开发者工具集成
